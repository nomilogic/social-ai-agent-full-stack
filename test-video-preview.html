<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Preview Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .container {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .video-preview {
            position: relative;
            margin: 20px 0;
        }
        .video-preview video {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .video-label {
            position: absolute;
            top: 8px;
            left: 8px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .upload-area {
            border: 2px dashed #444;
            padding: 40px;
            text-align: center;
            border-radius: 8px;
            margin: 20px 0;
        }
        .upload-area:hover {
            border-color: #666;
            background: rgba(255,255,255,0.05);
        }
        .file-input {
            margin: 20px 0;
        }
        .file-input input {
            background: #333;
            color: white;
            padding: 10px;
            border: 1px solid #555;
            border-radius: 4px;
            width: 100%;
        }
        .preview-container {
            min-height: 200px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 20px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: rgba(0,255,0,0.2); border: 1px solid #0a0; }
        .error { background: rgba(255,0,0,0.2); border: 1px solid #a00; }
        .info { background: rgba(0,0,255,0.2); border: 1px solid #00a; }
    </style>
</head>
<body>
    <h1>üé¨ Video Preview Test</h1>
    <p>This test page verifies that video preview functionality works correctly in your browser.</p>
    
    <div class="container">
        <h2>1. Local File Upload Test</h2>
        <div class="file-input">
            <label for="videoFile">Select a video file:</label>
            <input type="file" id="videoFile" accept="video/*" />
        </div>
        
        <div id="localPreview" class="preview-container">
            <p>No video selected yet. Choose a video file above.</p>
        </div>
    </div>
    
    <div class="container">
        <h2>2. Video URL Test</h2>
        <div class="file-input">
            <label for="videoUrl">Enter video URL:</label>
            <input 
                type="text" 
                id="videoUrl" 
                placeholder="https://example.com/video.mp4"
                value="https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4"
            />
            <button onclick="loadVideoFromUrl()" style="margin-left: 10px; padding: 10px 20px; background: #007acc; color: white; border: none; border-radius: 4px; cursor: pointer;">Load Video</button>
        </div>
        
        <div id="urlPreview" class="preview-container">
            <p>Click "Load Video" to test video URL loading.</p>
        </div>
    </div>
    
    <div class="container">
        <h2>3. Different Video Formats Test</h2>
        <p>Testing various video formats that your app should support:</p>
        
        <div class="video-preview">
            <h4>MP4 (Most common)</h4>
            <video controls preload="metadata" style="max-height: 200px;">
                <source src="https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>
            <div class="video-label">
                üìπ MP4 Video
            </div>
        </div>
    </div>
    
    <div class="container">
        <h2>4. Video Detection Logic Test</h2>
        <div id="detectionTest">
            <p>Testing the same video detection logic used in your app:</p>
        </div>
    </div>

    <script>
        // Video detection logic (same as in your app)
        function isVideoUrl(url) {
            if (!url) return false;
            return url.match(/\.(mp4|mov|avi|wmv|flv|webm|mkv|m4v)$/i) !== null;
        }

        function isVideoFile(file) {
            return file && file.type && file.type.startsWith('video/');
        }

        function createVideoPreview(src, container, label = 'Video') {
            container.innerHTML = `
                <div class="video-preview">
                    <video controls preload="metadata" style="max-height: 200px; max-width: 100%;">
                        <source src="${src}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <div class="video-label">üìπ ${label}</div>
                </div>
                <div class="status success">‚úÖ Video loaded successfully</div>
            `;
        }

        function createImagePreview(src, container, label = 'Image') {
            container.innerHTML = `
                <div class="video-preview">
                    <img src="${src}" style="max-height: 200px; max-width: 100%; border-radius: 8px;" alt="Preview">
                    <div class="video-label">üñºÔ∏è ${label}</div>
                </div>
                <div class="status success">‚úÖ Image loaded successfully</div>
            `;
        }

        function showError(container, message) {
            container.innerHTML = `<div class="status error">‚ùå ${message}</div>`;
        }

        function showLoading(container, message) {
            container.innerHTML = `<div class="status info">‚è≥ ${message}</div>`;
        }

        // Local file upload handler
        document.getElementById('videoFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const container = document.getElementById('localPreview');
            
            if (!file) {
                container.innerHTML = '<p>No file selected.</p>';
                return;
            }

            showLoading(container, 'Loading file preview...');

            try {
                const objectUrl = URL.createObjectURL(file);
                
                if (isVideoFile(file)) {
                    createVideoPreview(objectUrl, container, `Local ${file.type}`);
                } else if (file.type.startsWith('image/')) {
                    createImagePreview(objectUrl, container, `Local ${file.type}`);
                } else {
                    showError(container, `Unsupported file type: ${file.type}`);
                }
            } catch (error) {
                showError(container, `Error creating preview: ${error.message}`);
            }
        });

        // URL video loader
        function loadVideoFromUrl() {
            const url = document.getElementById('videoUrl').value.trim();
            const container = document.getElementById('urlPreview');
            
            if (!url) {
                showError(container, 'Please enter a video URL');
                return;
            }

            showLoading(container, 'Loading video from URL...');

            if (isVideoUrl(url)) {
                // Test if the video URL is accessible
                const video = document.createElement('video');
                video.onloadstart = () => {
                    createVideoPreview(url, container, 'Remote Video');
                };
                video.onerror = () => {
                    showError(container, 'Failed to load video from URL. Check if the URL is accessible.');
                };
                video.src = url;
                video.load();
            } else {
                // Assume it's an image URL
                const img = new Image();
                img.onload = () => {
                    createImagePreview(url, container, 'Remote Image');
                };
                img.onerror = () => {
                    showError(container, 'Failed to load image from URL. Check if the URL is accessible.');
                };
                img.src = url;
            }
        }

        // Test video detection logic
        function testVideoDetection() {
            const testCases = [
                { url: 'video.mp4', expected: true },
                { url: 'video.webm', expected: true },
                { url: 'video.mov', expected: true },
                { url: 'image.jpg', expected: false },
                { url: 'image.png', expected: false },
                { url: 'https://example.com/video.mp4', expected: true },
                { url: 'https://example.com/video.mp4?version=1', expected: true },
                { url: 'data:video/mp4;base64,abc...', expected: false }, // Should be false due to data URL
            ];

            const container = document.getElementById('detectionTest');
            let results = '<ul>';
            
            testCases.forEach(test => {
                const result = isVideoUrl(test.url);
                const status = result === test.expected ? '‚úÖ' : '‚ùå';
                const statusClass = result === test.expected ? 'success' : 'error';
                
                results += `<li><span class="status ${statusClass}">${status} "${test.url}" ‚Üí ${result} (expected: ${test.expected})</span></li>`;
            });
            
            results += '</ul>';
            container.innerHTML = results;
        }

        // Run detection test on page load
        window.onload = function() {
            testVideoDetection();
            
            // Show diagnostic info
            const info = document.createElement('div');
            info.className = 'container';
            info.innerHTML = `
                <h2>Browser Support Info</h2>
                <div class="status info">
                    <p><strong>User Agent:</strong> ${navigator.userAgent}</p>
                    <p><strong>Supported Video Types:</strong></p>
                    <ul>
                        <li>MP4: ${document.createElement('video').canPlayType('video/mp4') || 'Not supported'}</li>
                        <li>WebM: ${document.createElement('video').canPlayType('video/webm') || 'Not supported'}</li>
                        <li>Ogg: ${document.createElement('video').canPlayType('video/ogg') || 'Not supported'}</li>
                    </ul>
                </div>
            `;
            document.body.appendChild(info);
        };
    </script>
</body>
</html>
